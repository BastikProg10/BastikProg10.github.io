<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #000;
      color: #FFD700;
      font-family: 'Montserrat', sans-serif;
      padding: 20px;
    }
    .line {
      margin-bottom: 10px;
    }
    .title {
      font-size: 22px;
      margin-bottom: 20px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="title">–ü—Ä–æ—Ñ–∏–ª—å</div>
  <div class="line" id="id">–ó–∞–≥—Ä—É–∑–∫–∞ ID...</div>
  <div class="line" id="balance">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞...</div>
  <div class="line" id="ref-link">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Å—ã–ª–∫–∏...</div>
  <div class="line" id="invited">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö...</div>
  <div class="line" id="inviter">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ...</div>
  <div class="line" id="reg-date">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏...</div>

  <script>
    Telegram.WebApp.ready();
    const user = Telegram.WebApp.initDataUnsafe?.user;

    if (!user?.id) {
      document.body.innerHTML = '<p class="error">–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à Telegram ID</p>';
    } else {
      fetch(`http://localhost:3000/get-profile?user_id=${user.id}`)
        .then(res => res.json())
        .then(data => {
          try {
            document.getElementById('id').textContent =
              `–í–∞—à –∞–π–¥–∏: ${data.id ?? '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ID'}`;

            document.getElementById('balance').textContent =
              `–ë–∞–ª–∞–Ω—Å: ${data.balance != null ? data.balance + ' ü™ô' : '‚ùå –û—à–∏–±–∫–∞'}`;

            document.getElementById('ref-link').textContent =
              data.id
                ? `–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: https://t.me/MifixDropBot/app?startapp=${data.id}`
                : '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';

            document.getElementById('invited').textContent =
              `–í—ã –ø—Ä–∏–≤–µ–ª–∏: ${data.invited_count != null ? data.invited_count + ' —á–µ–ª' : '‚ùå –û—à–∏–±–∫–∞'}`;

            document.getElementById('inviter').textContent =
              `–í–∞—Å –ø—Ä–∏–≤–µ–ª: ${data.inviter || '‚ùå –ù–µ —É–∫–∞–∑–∞–Ω–æ'}`;

            document.getElementById('reg-date').textContent =
              data.registered_at
                ? `–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${new Date(data.registered_at).toLocaleString()}`
                : '‚ùå –î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
          }
        })
        .catch(err => {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', err);
          document.getElementById('id').innerHTML = '<span class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</span>';
        });
    }
  </script>

</body>
</html>
